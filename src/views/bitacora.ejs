<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="mb-1">Bit치cora de Accesos</h2>
    <p class="text-muted mb-0">Registro de inicios de sesi칩n y actividad del sistema</p>
  </div>
  <a href="/configuracion" class="btn btn-outline-secondary">
    <i class="bi bi-arrow-left me-1"></i> Volver
  </a>
</div>

<% if (typeof messages !== 'undefined') { %>
  <% if (messages.error) { %>
    <div class="alert alert-danger alert-dismissible fade show">
      <i class="bi bi-exclamation-circle me-2"></i><%= messages.error %>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
  <% } %>
<% } %>

<div class="card">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead>
          <tr>
            <th>Fecha/Hora</th>
            <th>Usuario</th>
            <th>Acci칩n</th>
            <th>IP</th>
            <th>Detalles</th>
          </tr>
        </thead>
        <tbody>
          <% if (registros.length === 0) { %>
            <tr>
              <td colspan="5" class="text-center py-4 text-muted">
                <i class="bi bi-journal-text fs-1 d-block mb-2"></i>
                No hay registros en la bit치cora
              </td>
            </tr>
          <% } else { %>
            <% registros.forEach(reg => { %>
              <tr>
                <td>
                  <small><%= reg.Fecha_Hora.toLocaleString('es-MX') %></small>
                </td>
                <td>
                  <% if (reg.usuario) { %>
                    <strong><%= reg.usuario.Nombre_Completo %></strong>
                    <br><small class="text-muted"><%= reg.usuario.Email_Office365 %></small>
                  <% } else { %>
                    <span class="text-muted">Usuario desconocido</span>
                  <% } %>
                </td>
                <td>
                  <% if (reg.Accion === 'Login') { %>
                    <span class="badge bg-success"><i class="bi bi-box-arrow-in-right me-1"></i>Login</span>
                  <% } else if (reg.Accion === 'Logout') { %>
                    <span class="badge bg-secondary"><i class="bi bi-box-arrow-right me-1"></i>Logout</span>
                  <% } else if (reg.Accion === 'Login Fallido') { %>
                    <span class="badge bg-danger"><i class="bi bi-exclamation-triangle me-1"></i>Fallido</span>
                  <% } else { %>
                    <span class="badge bg-info"><%= reg.Accion %></span>
                  <% } %>
                </td>
                <td><code><%= reg.IP_Address || '-' %></code></td>
                <td><small><%= reg.Detalles || '-' %></small></td>
              </tr>
            <% }) %>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</div>
